<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<main>
  <h1><%= recipe.name %></h1>
  <h2>By <%= recipe.author.name %></h2>
  <img src="<%= recipe.imageUrl %>" alt="<%= recipe.name %> image">
  <h2><%= recipe.description %></h2>
  <div>
    <h3>Ingredients: </h3>
    <ul>
      <% recipe.ingredients.forEach(ingredient => { %>
        <li><%= ingredient %></li>
      <% }) %>
    </ul>
  </div>
  <div>
    <h3>Steps: </h3>
    <ul>
      <% recipe.instructions.forEach(instruction => { %>
        <li><%= instruction %></li>
      <% }) %>
    </ul>
  </div>
  <% if (recipe.author.equals(user?.profile._id)) { %>
    <form action="/recipes/<%= recipe.id %>/edit" method="GET">
      <button type="submit">Edit this recipe</button>
    </form>
  <% } %>
  <% if (recipe.author.equals(user?.profile._id)) { %>
    <form action="/recipes/<%= recipe._id %>?_method=DELETE" method="POST">
      <button type="submit">Delete this recipe</button>
    </form>
  <% } %>
  <% if (user?.profile._id) { %>
    <form action="/recipes/<%= recipe._id %>/comments" method="POST">
      <label for="content-textarea">Comments:</label>
      <textarea name="content" id="content-textarea"></textarea>
      <label for="rating-select">Rating:</label>
      <select name="rating" id="rating-select">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5" selected>5</option>
      </select>
      <button type="submit">Add Comment</button>
    </form>
  <% } %>
  <% recipe.comments.forEach(comment => { %>
    <div>
      <h3><%= comment.author.name %></h3>
      <h4><%= comment.createdAt.toLocaleDateString() %></h4>
      <p><%= comment.rating %></p>
      <p><%= comment.content %></p>
      <div>
        <% if (comment.author.equals(user?.profile._id)) { %>
          <form action="/recipes/<%= recipe._id %>/comments/<%= comment._id %> ?_method=DELETE" method="post">
            <button type="submit">Delete this comment?</button>
          </form>
        <% } %> 
      </div>
    </div>
  <% }) %>
</main>

<%- include('../partials/footer') %>
